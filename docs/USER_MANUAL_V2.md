# BESS Site Survey System v2.0 - ユーザーマニュアル

**バージョン**: 2.0.0  
**対象**: システム利用者  
**最終更新**: 2025年10月6日

---

## 📋 目次

1. [はじめに](#はじめに)
2. [ログイン](#ログイン)
3. [サイト一覧](#サイト一覧)
4. [サイト詳細](#サイト詳細)
5. [サイト作成・編集](#サイト作成編集)
6. [自動化機能](#自動化機能)
7. [一括処理](#一括処理)
8. [トラブルシューティング](#トラブルシューティング)

---

## はじめに

### システム概要

BESS Site Survey System v2.0は、蓄電池設置候補地の評価・管理を効率化するシステムです。

### 主要機能

- ✅ サイト情報の管理（作成・編集・削除）
- ✅ 標高データの自動取得
- ✅ 総合スコアの自動計算
- ✅ 一括処理機能
- ✅ スコア履歴の追跡
- ✅ 監査ログの記録

### 必要な環境

- **ブラウザ**: Chrome、Firefox、Safari、Edge（最新版）
- **画面解像度**: 1280x720以上推奨
- **インターネット接続**: 必須

---

## ログイン

### 1. ログインページにアクセス

ブラウザで以下のURLにアクセスします：
```
http://localhost:5173/login
```

### 2. 認証情報を入力

- メールアドレス
- パスワード

### 3. ログインボタンをクリック

認証に成功すると、ダッシュボードに遷移します。

---

## サイト一覧

### 画面の見方

サイト一覧ページでは、登録されている全サイトを確認できます。

#### 表示項目

| 項目 | 説明 |
|------|------|
| サイトコード | 自動生成される一意のコード（例: STB2025-000001） |
| サイト名 | サイトの名称 |
| 自動化レベル | データ取得方法（AUTO/SEMI/MANUAL） |
| スコア | 総合評価スコアとグレード（S/A/B/C/D） |
| 系統容量 | 利用可能な系統容量（MW） |
| ステータス | 承認状態 |
| 優先度 | 優先度ランク（A/B/C） |

### フィルター機能

#### 検索

1. 検索ボックスにキーワードを入力
2. 「検索」ボタンをクリック
3. サイト名または住所で検索されます

#### ステータスフィルター

- 全て
- 下書き
- 審査中
- 承認済み
- 却下
- 保留

#### 優先度フィルター

- 全て
- A（高）
- B（中）
- C（低）

### ページネーション

- 1ページあたり20件表示
- ページ番号をクリックして移動
- 「前へ」「次へ」ボタンで移動

### ソート機能

各カラムのヘッダーをクリックすると、その項目でソートされます。
- 1回目のクリック: 昇順
- 2回目のクリック: 降順

### 操作

#### サイト詳細を見る

- 行をクリック → サイト詳細ページへ遷移
- 「詳細」ボタンをクリック → サイト詳細ページへ遷移

#### サイトを編集する

「編集」ボタンをクリック → サイト編集ページへ遷移

#### 新規サイトを作成する

右上の「+ 新規サイト」ボタンをクリック → サイト作成ページへ遷移

---

## サイト詳細

### タブ構成

サイト詳細ページは8つのタブで構成されています。

#### 1. 基本情報タブ

**表示内容**:
- サイトコード
- サイト名
- 住所
- 座標（緯度・経度）
- 面積
- ステータス
- 優先度
- 作成日時

#### 2. 系統情報タブ

**表示内容**:
- 目標電圧（kV）
- 変電所距離（m）
- 利用可能容量（MW）
- 接続コスト（円）
- 自動化レベル
- 備考

**自動化レベルの意味**:
- 🟢 **AUTO**: 完全自動取得
- 🟡 **SEMI**: 半自動（一部手動確認）
- ⚪ **MANUAL**: 手動入力

#### 3. 地理リスクタブ

**表示内容**:
- 標高（m）
- 傾斜（%）
- 浸水深クラス
- 液状化リスク
- 自動化レベル
- 備考

**操作**:
- 「標高取得」ボタン: Google Elevation APIから標高を自動取得

#### 4. スコア履歴タブ

**表示内容**:
- 最新スコア（カテゴリ別）
  - 系統接続性（30%）
  - 地理リスク（25%）
  - 法規制（20%）
  - アクセス性（15%）
  - 経済性（10%）
- 総合スコアとグレード
- スコア履歴テーブル

**グレードの意味**:
- 🟣 **S**: 優秀（90点以上）
- 🔵 **A**: 良好（80-89点）
- 🟢 **B**: 普通（70-79点）
- 🟡 **C**: 要改善（60-69点）
- 🔴 **D**: 不適（60点未満）

**操作**:
- 「スコア再計算」ボタン: 最新データでスコアを再計算

#### 5. 自動化タブ

**表示内容**:
- 利用可能な自動化機能
- 実行ボタン

**操作**:
1. 「標高取得」ボタン: 標高データを自動取得
2. 「スコア再計算」ボタン: スコアを再計算

### ヘッダー操作

#### 編集ボタン

右上の「編集」ボタンをクリック → サイト編集ページへ遷移

#### 戻るボタン

左上の「← 一覧に戻る」をクリック → サイト一覧ページへ戻る

---

## サイト作成・編集

### サイト作成

#### 1. 新規作成ページを開く

サイト一覧ページの「+ 新規サイト」ボタンをクリック

#### 2. 基本情報を入力

**必須項目**（*マーク付き）:
- 住所
- 緯度
- 経度

**任意項目**:
- サイト名
- 面積（m²）
- 土地権利状況
- ステータス（デフォルト: 下書き）
- 優先度

#### 3. 入力内容を確認

バリデーションエラーがある場合、赤字でエラーメッセージが表示されます。

**バリデーションルール**:
- 住所: 必須
- 緯度: -90 ～ 90の範囲
- 経度: -180 ～ 180の範囲
- 面積: 正の数値

#### 4. 作成ボタンをクリック

「作成」ボタンをクリックすると、サイトが作成され、詳細ページに遷移します。

### サイト編集

#### 1. 編集ページを開く

- サイト詳細ページの「編集」ボタンをクリック
- または、サイト一覧ページの「編集」ボタンをクリック

#### 2. 情報を修正

変更したい項目を編集します。

**注意**:
- サイトコードは変更できません（自動生成）

#### 3. 更新ボタンをクリック

「更新」ボタンをクリックすると、変更が保存され、詳細ページに戻ります。

### キャンセル

「キャンセル」ボタンをクリックすると、変更を破棄して前のページに戻ります。

---

## 自動化機能

### 標高自動取得

#### 機能概要

Google Elevation APIを使用して、サイトの標高を自動的に取得します。

#### 使用方法

1. サイト詳細ページを開く
2. 「地理リスク」タブまたは「自動化」タブを選択
3. 「標高取得」ボタンをクリック
4. 処理完了を待つ（通常1-2秒）
5. 標高データが更新される

#### 注意事項

- Google Maps APIキーが必要
- 1日あたり2,500リクエストまで（無料枠）
- 取得した標高は自動的にgeo_riskテーブルに保存される
- 自動化レベルが「AUTO」に設定される

### スコア自動計算

#### 機能概要

5つのカテゴリを評価し、総合スコアとグレードを自動計算します。

#### 評価カテゴリ

1. **系統接続性**（30%）
   - 変電所距離
   - 系統容量
   - 接続コスト

2. **地理リスク**（25%）
   - 標高
   - 傾斜
   - 浸水リスク
   - 液状化リスク

3. **法規制**（20%）
   - 用途地域
   - 農地区分
   - 保護区域

4. **アクセス性**（15%）
   - 道路幅員
   - 道路種別
   - 区画形状

5. **経済性**（10%）
   - 地価
   - 計画出力
   - 収益見込み

#### 使用方法

1. サイト詳細ページを開く
2. 「スコア履歴」タブまたは「自動化」タブを選択
3. 「スコア再計算」ボタンをクリック
4. 処理完了を待つ（通常1秒未満）
5. 最新スコアが表示される

#### スコアの見方

- **総合スコア**: 0-100点
- **グレード**: S/A/B/C/D
- **カテゴリ別スコア**: 各カテゴリの詳細評価

---

## 一括処理

### 一括自動化ページ

複数のサイトに対して、標高取得やスコア計算を一括実行できます。

#### アクセス方法

サイト一覧ページから「一括自動化」リンクをクリック

### サイト選択

#### 個別選択

各サイトのチェックボックスをクリック

#### 全選択/全解除

「全選択」ボタンをクリック → 全サイトを選択  
「全解除」ボタンをクリック → 選択を解除

### 一括標高取得

#### 手順

1. 処理したいサイトを選択
2. 「標高取得実行」ボタンをクリック
3. 確認ダイアログで「OK」をクリック
4. 処理完了を待つ
5. 結果を確認

#### 実行結果

- 成功件数
- 失敗件数
- 各サイトの詳細結果

#### 注意事項

- 処理には時間がかかる場合があります（1サイトあたり1-2秒）
- API制限により、大量のサイトを一度に処理できない場合があります
- 失敗したサイトは個別に再実行してください

### 一括スコア計算

#### 手順

1. 処理したいサイトを選択
2. 「スコア計算実行」ボタンをクリック
3. 確認ダイアログで「OK」をクリック
4. 処理完了を待つ
5. 結果を確認

#### 実行結果

- 成功件数
- 失敗件数
- 各サイトの詳細結果（スコアとグレード）

---

## トラブルシューティング

### よくある問題と解決方法

#### 1. ログインできない

**症状**: ログインボタンをクリックしてもログインできない

**解決方法**:
- メールアドレスとパスワードが正しいか確認
- ブラウザのキャッシュをクリア
- 別のブラウザで試す
- システム管理者に連絡

#### 2. サイトが表示されない

**症状**: サイト一覧ページに何も表示されない

**解決方法**:
- フィルターが設定されていないか確認
- ページをリロード（F5キー）
- ネットワーク接続を確認

#### 3. 標高取得が失敗する

**症状**: 「標高取得」ボタンをクリックしてもエラーになる

**解決方法**:
- Google Maps APIキーが設定されているか確認
- API制限に達していないか確認（1日2,500リクエスト）
- 座標（緯度・経度）が正しいか確認
- しばらく時間をおいて再試行

#### 4. スコア計算が失敗する

**症状**: 「スコア再計算」ボタンをクリックしてもエラーになる

**解決方法**:
- 必要なデータが入力されているか確認
- ページをリロードして再試行
- システム管理者に連絡

#### 5. 保存できない

**症状**: サイト作成・編集時に保存できない

**解決方法**:
- 必須項目（*マーク）が全て入力されているか確認
- バリデーションエラーメッセージを確認
- 入力値が正しい範囲内か確認
- ネットワーク接続を確認

#### 6. 画面が正しく表示されない

**症状**: レイアウトが崩れている、ボタンが表示されない

**解決方法**:
- ブラウザを最新版に更新
- ブラウザのキャッシュをクリア
- 画面を拡大/縮小していないか確認（100%推奨）
- 別のブラウザで試す

### エラーメッセージ一覧

| エラーメッセージ | 意味 | 対処方法 |
|----------------|------|---------|
| 住所は必須です | 住所が入力されていない | 住所を入力してください |
| 緯度は-90から90の範囲で入力してください | 緯度の値が範囲外 | 正しい緯度を入力してください |
| 経度は-180から180の範囲で入力してください | 経度の値が範囲外 | 正しい経度を入力してください |
| Google Elevation API is not configured | APIキーが未設定 | システム管理者に連絡してください |
| Site not found | サイトが見つからない | サイトIDを確認してください |
| Failed to calculate score | スコア計算失敗 | データを確認して再試行してください |

### サポート

問題が解決しない場合は、システム管理者に連絡してください。

**連絡時に必要な情報**:
- 発生した問題の詳細
- エラーメッセージ（表示されている場合）
- 操作手順
- 使用しているブラウザとバージョン
- スクリーンショット（可能な場合）

---

## 付録

### キーボードショートカット

| ショートカット | 機能 |
|--------------|------|
| F5 | ページリロード |
| Ctrl + F | ページ内検索 |
| Esc | モーダルを閉じる |

### 用語集

| 用語 | 説明 |
|------|------|
| サイトコード | システムが自動生成する一意の識別子 |
| 自動化レベル | データ取得方法（AUTO/SEMI/MANUAL） |
| スコア | サイトの総合評価（0-100点） |
| グレード | スコアに基づく評価ランク（S/A/B/C/D） |
| 系統容量 | 電力系統で利用可能な容量（MW） |
| 液状化リスク | 地震時の地盤液状化の危険度 |
| 監査ログ | データ変更履歴の記録 |

---

**マニュアルバージョン**: 2.0.0  
**最終更新**: 2025年10月6日  
**作成者**: Kiro AI Assistant

ご不明な点がございましたら、システム管理者までお問い合わせください。
