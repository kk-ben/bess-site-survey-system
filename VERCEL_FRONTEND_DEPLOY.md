# ğŸš€ BESS Site Survey System - Vercelãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¬ã‚¤ãƒ‰

## ğŸ“‹ å‰ææ¡ä»¶

- âœ… GitHubã‚¢ã‚«ã‚¦ãƒ³ãƒˆ
- âœ… Vercelã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆç„¡æ–™ï¼‰
- âœ… ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIãŒVPSã«ãƒ‡ãƒ—ãƒ­ã‚¤æ¸ˆã¿ï¼ˆhttps://api.ps-system.jpï¼‰
- âœ… Supabaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆæ¸ˆã¿

---

## ğŸ¯ ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †

### ã‚¹ãƒ†ãƒƒãƒ—1: GitHubãƒªãƒã‚¸ãƒˆãƒªã®ç¢ºèª

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒGitHubã«ãƒ—ãƒƒã‚·ãƒ¥ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªï¼š

```bash
cd bess-site-survey-system
git status
git push origin main
```

---

### ã‚¹ãƒ†ãƒƒãƒ—2: Vercelã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ

1. [Vercel](https://vercel.com)ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ã€ŒSign Upã€ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ã€ŒContinue with GitHubã€ã‚’é¸æŠ
4. GitHubã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§èªè¨¼

---

### ã‚¹ãƒ†ãƒƒãƒ—3: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ

1. Vercelãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ã€ŒAdd New...ã€â†’ã€ŒProjectã€ã‚’ã‚¯ãƒªãƒƒã‚¯
2. ã€ŒImport Git Repositoryã€ã‹ã‚‰ `bess-site-survey-system` ã‚’é¸æŠ
3. ã€ŒImportã€ã‚’ã‚¯ãƒªãƒƒã‚¯

---

### ã‚¹ãƒ†ãƒƒãƒ—4: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š

#### 4.1 Framework Preset

- **Framework Preset**: Vite
- **Root Directory**: `frontend`ï¼ˆé‡è¦ï¼ï¼‰

ã€ŒEditã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ `frontend` ã‚’æŒ‡å®šã—ã¦ãã ã•ã„ã€‚

#### 4.2 Build Settings

ä»¥ä¸‹ã®è¨­å®šãŒè‡ªå‹•çš„ã«é©ç”¨ã•ã‚Œã¾ã™ï¼š

- **Build Command**: `npm run build`
- **Output Directory**: `dist`
- **Install Command**: `npm install`

---

### ã‚¹ãƒ†ãƒƒãƒ—5: ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

ã€ŒEnvironment Variablesã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ä»¥ä¸‹ã‚’è¿½åŠ ï¼š

#### å¿…é ˆã®ç’°å¢ƒå¤‰æ•°

```env
# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰API URL
VITE_API_BASE_URL=https://api.ps-system.jp/api/v1

# Supabaseè¨­å®š
VITE_SUPABASE_URL=https://your-project.supabase.co
VITE_SUPABASE_ANON_KEY=your-supabase-anon-key

# Google Maps API Keyï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
VITE_GOOGLE_MAPS_API_KEY=your-google-maps-api-key
```

**é‡è¦**: 
- `VITE_SUPABASE_URL` ã¨ `VITE_SUPABASE_ANON_KEY` ã¯ã€Supabaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã€ŒSettingsã€â†’ã€ŒAPIã€ã‹ã‚‰å–å¾—
- ã™ã¹ã¦ã®ç’°å¢ƒå¤‰æ•°ã¯ `VITE_` ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ãŒå¿…è¦ï¼ˆViteã®ä»•æ§˜ï¼‰

---

### ã‚¹ãƒ†ãƒƒãƒ—6: ãƒ‡ãƒ—ãƒ­ã‚¤å®Ÿè¡Œ

1. ã€ŒDeployã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
2. ãƒ“ãƒ«ãƒ‰ãƒ—ãƒ­ã‚»ã‚¹ãŒé–‹å§‹ã•ã‚Œã¾ã™ï¼ˆç´„2-3åˆ†ï¼‰
3. ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†å¾Œã€URLãŒè¡¨ç¤ºã•ã‚Œã¾ã™

ä¾‹: `https://bess-site-survey-system.vercel.app`

---

### ã‚¹ãƒ†ãƒƒãƒ—7: ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³ã®è¨­å®šï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

#### 7.1 Vercelã§ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’è¿½åŠ 

1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã€ŒSettingsã€â†’ã€ŒDomainsã€
2. ã€ŒAddã€ã‚’ã‚¯ãƒªãƒƒã‚¯
3. `bess.ps-system.jp` ã‚’å…¥åŠ›
4. è¡¨ç¤ºã•ã‚Œã‚‹DNSãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ãƒ¡ãƒ¢

#### 7.2 ã•ãã‚‰VPSã§DNSãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ 

ã•ãã‚‰VPSã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ«ã§ä»¥ä¸‹ã‚’è¿½åŠ ï¼š

```
ã‚¿ã‚¤ãƒ—: CNAME
ãƒ›ã‚¹ãƒˆå: bess
å€¤: cname.vercel-dns.com
TTL: 3600
```

ã¾ãŸã¯ã€Aãƒ¬ã‚³ãƒ¼ãƒ‰ã®å ´åˆï¼š

```
ã‚¿ã‚¤ãƒ—: A
ãƒ›ã‚¹ãƒˆå: bess
å€¤: 76.76.21.21
TTL: 3600
```

#### 7.3 SSLè¨¼æ˜æ›¸ã®è‡ªå‹•ç™ºè¡Œ

VercelãŒè‡ªå‹•çš„ã«SSLè¨¼æ˜æ›¸ã‚’ç™ºè¡Œã—ã¾ã™ï¼ˆæ•°åˆ†ã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ï¼‰ã€‚

---

### ã‚¹ãƒ†ãƒƒãƒ—8: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®CORSè¨­å®šã‚’æ›´æ–°

VPSã«SSHæ¥ç¶šã—ã¦ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ç’°å¢ƒå¤‰æ•°ã‚’æ›´æ–°ï¼š

```bash
ssh root@153.121.61.164

# ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†
nano /var/www/bess-site-survey-system/.env.production
```

`CORS_ORIGIN` ã‚’æ›´æ–°ï¼š

```env
# Vercelã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã«å¤‰æ›´
CORS_ORIGIN=https://bess-site-survey-system.vercel.app

# ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆ
# CORS_ORIGIN=https://bess.ps-system.jp
```

ä¿å­˜å¾Œã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å†èµ·å‹•ï¼š

```bash
pm2 restart bess-api
pm2 logs bess-api --lines 50
```

---

## âœ… å‹•ä½œç¢ºèª

### 1. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã«ã‚¢ã‚¯ã‚»ã‚¹

ãƒ–ãƒ©ã‚¦ã‚¶ã§ä»¥ä¸‹ã«ã‚¢ã‚¯ã‚»ã‚¹ï¼š
- https://bess-site-survey-system.vercel.app
- ã¾ãŸã¯ https://bess.ps-system.jpï¼ˆã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³è¨­å®šæ™‚ï¼‰

### 2. APIã¨ã®æ¥ç¶šç¢ºèª

1. ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
2. ãƒ–ãƒ©ã‚¦ã‚¶ã®é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ï¼ˆF12ï¼‰ã‚’é–‹ã
3. ã€ŒConsoleã€ã‚¿ãƒ–ã§ã‚¨ãƒ©ãƒ¼ãŒãªã„ã“ã¨ã‚’ç¢ºèª
4. ã€ŒNetworkã€ã‚¿ãƒ–ã§APIãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒæˆåŠŸã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª

### 3. ãƒ†ã‚¹ãƒˆãƒ­ã‚°ã‚¤ãƒ³

åˆæœŸç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³ï¼š
- Email: `admin@example.com`
- Password: `admin123`

---

## ğŸ”„ è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ã®è¨­å®š

Vercelã¯è‡ªå‹•çš„ã«GitHubã¨é€£æºã—ã¦ã„ã¾ã™ï¼š

- **mainãƒ–ãƒ©ãƒ³ãƒã«ãƒ—ãƒƒã‚·ãƒ¥** â†’ æœ¬ç•ªç’°å¢ƒã«è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤
- **ä»–ã®ãƒ–ãƒ©ãƒ³ãƒã«ãƒ—ãƒƒã‚·ãƒ¥** â†’ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç’°å¢ƒã«è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤

### ãƒ‡ãƒ—ãƒ­ã‚¤ã®ç¢ºèª

```bash
# ãƒ­ãƒ¼ã‚«ãƒ«ã§å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆ
git add .
git commit -m "Update frontend"
git push origin main

# VercelãŒè‡ªå‹•çš„ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’é–‹å§‹
# ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§é€²æ—ã‚’ç¢ºèªã§ãã¾ã™
```

---

## ğŸ”§ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼

#### ã‚¨ãƒ©ãƒ¼: "Root Directory not found"

**è§£æ±ºç­–**: 
1. Vercelãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã€ŒSettingsã€â†’ã€ŒGeneralã€
2. ã€ŒRoot Directoryã€ã‚’ `frontend` ã«è¨­å®š
3. ã€ŒSaveã€ã‚’ã‚¯ãƒªãƒƒã‚¯
4. ã€ŒDeploymentsã€ã‹ã‚‰å†ãƒ‡ãƒ—ãƒ­ã‚¤

#### ã‚¨ãƒ©ãƒ¼: "Environment variable not found"

**è§£æ±ºç­–**:
1. ã€ŒSettingsã€â†’ã€ŒEnvironment Variablesã€
2. ã™ã¹ã¦ã®ç’°å¢ƒå¤‰æ•°ãŒ `VITE_` ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ä»˜ãã§è¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
3. å¤‰æ›´å¾Œã€å†ãƒ‡ãƒ—ãƒ­ã‚¤

### CORSã‚¨ãƒ©ãƒ¼

ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ä»¥ä¸‹ã®ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹å ´åˆï¼š

```
Access to fetch at 'https://api.ps-system.jp/api/v1/...' from origin 'https://bess-site-survey-system.vercel.app' has been blocked by CORS policy
```

**è§£æ±ºç­–**:
1. VPSã«SSHæ¥ç¶š
2. `/var/www/bess-site-survey-system/.env.production` ã® `CORS_ORIGIN` ã‚’ç¢ºèª
3. Vercelã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã¨ä¸€è‡´ã—ã¦ã„ã‚‹ã‹ç¢ºèª
4. `pm2 restart bess-api` ã§å†èµ·å‹•

### APIã«æ¥ç¶šã§ããªã„

**è§£æ±ºç­–**:
1. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèªï¼š
   ```bash
   curl https://api.ps-system.jp/api/v1/health
   ```
2. Vercelã®ç’°å¢ƒå¤‰æ•° `VITE_API_BASE_URL` ãŒæ­£ã—ã„ã‹ç¢ºèª
3. ãƒ–ãƒ©ã‚¦ã‚¶ã®é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã§å®Ÿéš›ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆURLã‚’ç¢ºèª

---

## ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### 1. ç”»åƒæœ€é©åŒ–

Vercelã¯è‡ªå‹•çš„ã«ç”»åƒã‚’æœ€é©åŒ–ã—ã¾ã™ãŒã€ä»¥ä¸‹ã‚‚æ¤œè¨ï¼š

```typescript
// next/imageã®ä»£ã‚ã‚Šã«Viteã®ç”»åƒæœ€é©åŒ–ã‚’ä½¿ç”¨
import imageUrl from './image.png?url'
```

### 2. ã‚³ãƒ¼ãƒ‰åˆ†å‰²

Viteã¯è‡ªå‹•çš„ã«ã‚³ãƒ¼ãƒ‰åˆ†å‰²ã‚’è¡Œã„ã¾ã™ãŒã€å¤§ããªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯é…å»¶èª­ã¿è¾¼ã¿ï¼š

```typescript
// é…å»¶èª­ã¿è¾¼ã¿
const HeavyComponent = lazy(() => import('./HeavyComponent'))
```

### 3. ã‚­ãƒ£ãƒƒã‚·ãƒ¥è¨­å®š

`vercel.json` ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’è¨­å®šï¼š

```json
{
  "headers": [
    {
      "source": "/assets/(.*)",
      "headers": [
        {
          "key": "Cache-Control",
          "value": "public, max-age=31536000, immutable"
        }
      ]
    }
  ]
}
```

---

## ğŸ“ˆ ç›£è¦–ã¨ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹

### Vercel Analyticsï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã€ŒAnalyticsã€ã‚¿ãƒ–
2. ã€ŒEnable Analyticsã€ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’ç¢ºèª

### ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³ã®SSLè¨¼æ˜æ›¸

VercelãŒè‡ªå‹•çš„ã«ç®¡ç†ã—ã¾ã™ï¼š
- è‡ªå‹•æ›´æ–°
- ç„¡æ–™
- Let's Encryptä½¿ç”¨

---

## ğŸ‰ ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†ï¼

ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãŒä»¥ä¸‹ã®URLã§ç¨¼åƒä¸­ï¼š
- **æœ¬ç•ªURL**: https://bess-site-survey-system.vercel.app
- **ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³**: https://bess.ps-system.jpï¼ˆè¨­å®šæ™‚ï¼‰

### å®Œå…¨ãªã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend (Vercel)         â”‚
â”‚   bess.vercel.app           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ HTTPS
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Backend API (VPS)         â”‚
â”‚   api.ps-system.jp          â”‚
â”‚   153.121.61.164            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ PostgreSQL
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Database (Supabase)       â”‚
â”‚   PostgreSQL + Auth         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

æ¬¡ã¯ã€å®Ÿéš›ã«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½¿ã£ã¦ãƒ†ã‚¹ãƒˆã—ã¾ã—ã‚‡ã†ï¼
