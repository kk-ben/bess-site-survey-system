# ğŸš€ BESS v2.0 ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ã¨ãƒ†ã‚¹ãƒˆæ‰‹é †

## ğŸ“‹ æº–å‚™å®Œäº†çŠ¶æ³

âœ… ã‚³ãƒ¼ãƒ‰ä¿®æ­£å®Œäº†  
âœ… ãƒ“ãƒ«ãƒ‰æˆåŠŸ  
âœ… ç’°å¢ƒå¤‰æ•°è¨­å®šå®Œäº†  
âœ… Supabaseã‚¹ã‚­ãƒ¼ãƒãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†  

---

## ğŸš€ ã‚¹ãƒ†ãƒƒãƒ—1: ã‚µãƒ¼ãƒãƒ¼èµ·å‹•

### æ–¹æ³•A: èµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½¿ç”¨ï¼ˆæ¨å¥¨ï¼‰

```powershell
cd bess-site-survey-system
.\start-server.ps1
```

### æ–¹æ³•B: æ‰‹å‹•èµ·å‹•

```powershell
cd bess-site-survey-system
npm run dev:backend
```

### æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›

```
ğŸš€ BESS Site Survey System API running on port 3000
ğŸ“Š Environment: development
ğŸ—„ï¸  Database: Connected
ğŸ”„ Cache: Disabled
```

---

## ğŸ§ª ã‚¹ãƒ†ãƒƒãƒ—2: APIãƒ†ã‚¹ãƒˆ

**åˆ¥ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’é–‹ã„ã¦å®Ÿè¡Œï¼š**

### æ–¹æ³•A: ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆä½¿ç”¨ï¼ˆæ¨å¥¨ï¼‰

```powershell
cd bess-site-survey-system
.\test-api.ps1
```

### æ–¹æ³•B: æ‰‹å‹•ãƒ†ã‚¹ãƒˆ

```powershell
# v2.0 APIæƒ…å ±å–å¾—
Invoke-RestMethod -Uri "http://localhost:3000/api/v2" -Method GET

# CSVãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
Invoke-WebRequest -Uri "http://localhost:3000/api/v2/import/template" -Method GET -OutFile "template.csv"

# ã‚µã‚¤ãƒˆä¸€è¦§å–å¾—ï¼ˆèªè¨¼ã‚¨ãƒ©ãƒ¼ãŒæœŸå¾…ã•ã‚Œã‚‹ï¼‰
Invoke-RestMethod -Uri "http://localhost:3000/api/v2/sites" -Method GET
```

---

## ğŸ“Š ã‚¹ãƒ†ãƒƒãƒ—3: ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æŠ•å…¥

### Supabase SQL Editorã§å®Ÿè¡Œ

```sql
-- ãƒ†ã‚¹ãƒˆã‚µã‚¤ãƒˆã‚’ä½œæˆ
INSERT INTO sites (site_code, name, address, lat, lon, area_m2, status)
VALUES (
    'STB2025-000001',
    'ãƒ†ã‚¹ãƒˆã‚µã‚¤ãƒˆï¼ˆæ±äº¬é§…ï¼‰',
    'æ±äº¬éƒ½åƒä»£ç”°åŒºä¸¸ã®å†…1-9-1',
    35.6812,
    139.7671,
    5000,
    'draft'
) RETURNING *;

-- Grid Infoã‚’è¿½åŠ 
INSERT INTO grid_info (
    site_id,
    target_voltage_kv,
    substation_distance_m,
    capacity_available_mw,
    automation_level
)
SELECT 
    id,
    66,
    1500,
    10.5,
    'MANUAL'
FROM sites WHERE site_code = 'STB2025-000001'
RETURNING *;

-- Geo Riskã‚’è¿½åŠ 
INSERT INTO geo_risk (
    site_id,
    elevation_m,
    slope_pct,
    automation_level
)
SELECT 
    id,
    10.5,
    2.3,
    'AUTO'
FROM sites WHERE site_code = 'STB2025-000001'
RETURNING *;

-- ç¢ºèªã‚¯ã‚¨ãƒª
SELECT 
    s.site_code,
    s.name,
    s.address,
    s.status,
    g.target_voltage_kv,
    g.capacity_available_mw,
    gr.elevation_m,
    gr.slope_pct
FROM sites s
LEFT JOIN grid_info g ON s.id = g.site_id
LEFT JOIN geo_risk gr ON s.id = gr.site_id
WHERE s.site_code = 'STB2025-000001';
```

---

## ğŸ¯ ã‚¹ãƒ†ãƒƒãƒ—4: ãƒ‡ãƒ¼ã‚¿å–å¾—ç¢ºèª

### Supabaseã§ç›´æ¥ç¢ºèª

```sql
-- ã‚µã‚¤ãƒˆä¸€è¦§
SELECT * FROM sites ORDER BY created_at DESC LIMIT 10;

-- Grid Info
SELECT * FROM grid_info LIMIT 10;

-- Geo Risk
SELECT * FROM geo_risk LIMIT 10;
```

---

## ğŸ› ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚¨ãƒ©ãƒ¼: "Cannot connect to server"

**åŸå› **: ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¦ã„ãªã„

**è§£æ±ºç­–**:
```powershell
.\start-server.ps1
```

---

### ã‚¨ãƒ©ãƒ¼: "Port 3000 is already in use"

**åŸå› **: ãƒãƒ¼ãƒˆ3000ãŒæ—¢ã«ä½¿ç”¨ä¸­

**è§£æ±ºç­–**:
```powershell
# ä½¿ç”¨ä¸­ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç¢ºèª
netstat -ano | findstr :3000

# ãƒ—ãƒ­ã‚»ã‚¹ã‚’çµ‚äº†
taskkill /PID [PIDç•ªå·] /F

# ã‚µãƒ¼ãƒãƒ¼ã‚’å†èµ·å‹•
.\start-server.ps1
```

---

### ã‚¨ãƒ©ãƒ¼: "Database connection failed"

**åŸå› **: Supabaseæ¥ç¶šæƒ…å ±ãŒæ­£ã—ããªã„

**è§£æ±ºç­–**:
1. `.env`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèª
2. `SUPABASE_URL`ã¨`SUPABASE_SERVICE_ROLE_KEY`ã‚’ç¢ºèª
3. Supabaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèª

---

### ã‚¨ãƒ©ãƒ¼: "JWT_SECRET not configured"

**åŸå› **: JWT_SECRETãŒè¨­å®šã•ã‚Œã¦ã„ãªã„

**è§£æ±ºç­–**:
```powershell
# .envãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½åŠ 
Add-Content .env "JWT_SECRET=your-super-secret-jwt-key-change-this-in-production"
```

---

## ğŸ“ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### 1. CSVã‚¤ãƒ³ãƒãƒ¼ãƒˆã®ãƒ†ã‚¹ãƒˆ

```powershell
# CSVãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
Invoke-WebRequest -Uri "http://localhost:3000/api/v2/import/template" -OutFile "import-template.csv"

# ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ç·¨é›†ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ 

# ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Ÿè¡Œï¼ˆèªè¨¼ãŒå¿…è¦ï¼‰
$csvContent = Get-Content "import-template.csv" -Raw
$body = @{
    csv_content = $csvContent
    trigger_initial_jobs = $true
} | ConvertTo-Json

Invoke-RestMethod -Uri "http://localhost:3000/api/v2/import/csv" `
    -Method POST `
    -ContentType "application/json" `
    -Body $body `
    -Headers @{ Authorization = "Bearer YOUR_TOKEN" }
```

### 2. èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã®å–å¾—

èªè¨¼æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹ã‹ã€é–‹ç™ºç’°å¢ƒã§ã¯ä¸€æ™‚çš„ã«èªè¨¼ã‚’ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### 3. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¨ã®é€£æº

ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‹ã‚‰v2.0 APIã‚’å‘¼ã³å‡ºã™ã‚ˆã†ã«è¨­å®šã—ã¾ã™ã€‚

---

## ğŸŠ å®Œäº†ï¼

v2.0 APIãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™ï¼

æ¬¡ã¯ã€å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ã‚’æŠ•å…¥ã—ã¦æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã—ã¦ãã ã•ã„ã€‚

---

**ä½œæˆæ—¥**: 2025å¹´10æœˆ5æ—¥  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: v2.0  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ã‚µãƒ¼ãƒãƒ¼èµ·å‹•æº–å‚™å®Œäº† âœ…
