# 📤 CSV アップロードガイド

UIから候補地データをCSVファイルでアップロードする方法を説明します。

## 📁 用意されているCSVファイル

### 1. テストデータ（既存データ）

**ファイル**: `database/test-data-sites.csv`
- **件数**: 21件
- **内容**: 関東・関西・九州の実在する工業地帯
- **用途**: 初期テストデータとして使用済み

### 2. サンプルデータ（小）

**ファイル**: `sample-data/sites-sample-small.csv`
- **件数**: 3件
- **内容**: 東京・神奈川・愛知の候補地
- **用途**: 少量データのアップロードテスト

### 3. サンプルデータ（中）

**ファイル**: `sample-data/sites-sample-medium.csv`
- **件数**: 10件
- **内容**: 全国各地の候補地（北海道〜山口）
- **用途**: 中規模データのアップロードテスト

### 4. テンプレート

**ファイル**: `sample-data/sites-template.csv`
- **件数**: 1件（サンプル行）
- **内容**: 入力例とフォーマット説明
- **用途**: 独自データ作成時のテンプレート

---

## 📋 CSVファイルのフォーマット

### 必須列

| 列名 | 説明 | 例 | 必須 |
|------|------|-----|------|
| `サイト名` | サイト名 | 茨城県つくば市 工業団地跡地 | ✅ |
| `緯度` | 緯度 | 36.0839 | ✅ |
| `経度` | 経度 | 140.0764 | ✅ |
| `住所` | 住所 | 茨城県つくば市東光台5-19 | ✅ |
| `面積` | 面積（㎡） | 50000 | ✅ |
| `土地利用` | 土地利用 | 工業用地/港湾用地 | ✅ |

### オプション列

| 列名 | 説明 | 例 | 必須 |
|------|------|-----|------|
| `備考` | 備考・メモ | 30MW規模の候補地 | ❌ |

### 座標の調べ方

1. **Google Maps**で場所を検索
2. 右クリック → 座標をコピー
3. 形式: `緯度, 経度` （例: `35.6895, 139.6917`）
4. CSVには緯度と経度を別々の列に入力

---

## 🚀 アップロード手順

### ステップ1: CSVファイルを準備

以下のいずれかを選択：

**オプションA: サンプルデータを使う**
```
sample-data/sites-sample-small.csv  （3件）
sample-data/sites-sample-medium.csv （10件）
```

**オプションB: 独自データを作成**
1. `sample-data/sites-template.csv` をコピー
2. Excelまたはテキストエディタで開く
3. データを入力
4. CSV形式で保存（UTF-8エンコーディング）

### ステップ2: UIからアップロード

1. https://bess-site-survey-system.vercel.app にログイン
2. 左メニュー → **データ取込** をクリック
3. 「ファイルを選択」ボタンをクリック
4. CSVファイルを選択
5. 「アップロード」ボタンをクリック

### ステップ3: 結果確認

- ✅ 成功: 「〇件のデータをインポートしました」
- ❌ エラー: エラーメッセージを確認

### ステップ4: データ確認

1. 左メニュー → **候補地管理** をクリック
2. アップロードしたデータが表示されることを確認

---

## 📝 CSVファイルの作成例

### Excelで作成する場合

1. **新規ワークブックを作成**
2. **1行目にヘッダーを入力**:
   ```
   サイト名 | 緯度 | 経度 | 住所 | 面積 | 土地利用 | 備考
   ```
3. **2行目以降にデータを入力**:
   ```
   東京都江東区 臨海工業地帯 | 35.6586 | 139.8200 | 東京都江東区青海2-4-32 | 50000 | 工業用地 | 30MW規模
   ```
4. **名前を付けて保存** → **CSV UTF-8 (コンマ区切り)** を選択

### テキストエディタで作成する場合

```csv
サイト名,緯度,経度,住所,面積,土地利用,備考
東京都江東区 臨海工業地帯,35.6586,139.8200,東京都江東区青海2-4-32,50000,工業用地,30MW規模の候補地
神奈川県川崎市 工業団地,35.5308,139.7028,神奈川県川崎市川崎区扇町5-1,42000,工業用地,25MW規模の候補地
```

**保存時の注意**:
- エンコーディング: **UTF-8**
- 拡張子: `.csv`
- 改行コード: LF または CRLF

---

## ✅ データ検証ルール

アップロード時に以下がチェックされます：

### 必須項目チェック
- [ ] すべての必須列が存在する
- [ ] 各行にすべての値が入力されている

### データ型チェック
- [ ] latitude: 数値（-90 〜 90）
- [ ] longitude: 数値（-180 〜 180）
- [ ] capacity_mw: 正の数値
- [ ] status: 指定された値のみ

### 重複チェック
- [ ] 同じ名前の候補地が存在しない
- [ ] 同じ座標の候補地が存在しない（許容誤差: 0.0001度）

---

## 🐛 よくあるエラーと対処法

### エラー1: "Invalid CSV format"

**原因**: CSVのフォーマットが正しくない

**対処法**:
- ヘッダー行が正しいか確認
- カンマ区切りになっているか確認
- 引用符が正しく閉じられているか確認

### エラー2: "Missing required field: latitude"

**原因**: 必須列が不足している

**対処法**:
- すべての必須列が存在するか確認
- 列名のスペルが正しいか確認

### エラー3: "Invalid latitude value"

**原因**: 緯度の値が範囲外または数値でない

**対処法**:
- 緯度: -90 〜 90 の範囲内
- 経度: -180 〜 180 の範囲内
- 数値として認識される形式（小数点はピリオド）

### エラー4: "Duplicate site name"

**原因**: 同じ名前の候補地が既に存在する

**対処法**:
- 候補地名を変更する
- 既存データを削除してから再アップロード

### エラー5: "Invalid area_sqm value"

**原因**: 面積の値が不正

**対処法**:
- 正の数値を入力（単位: ㎡）
- 例: 50000（5万㎡）
- 空欄でもOK（オプション項目）

---

## 💡 ベストプラクティス

### 1. 少量でテスト

初めてアップロードする場合:
1. まず3件程度の小さいファイルでテスト
2. 成功したら本番データをアップロード

### 2. バックアップを取る

- アップロード前に既存データをエクスポート
- 問題があれば元に戻せるようにする

### 3. データを検証

- Excelで開いて目視確認
- 座標が正しいかGoogle Mapsで確認
- 容量の単位が正しいか確認（MW）

### 4. 段階的にアップロード

大量データの場合:
1. 地域別に分割（関東、関西、九州など）
2. 各ファイルを順次アップロード
3. 各回の結果を確認

---

## 📊 アップロード後の確認

### 1. 件数確認

```
ダッシュボード → 総候補地数
```

アップロード前後で件数が増えているか確認

### 2. データ確認

```
候補地管理 → 検索
```

アップロードしたデータが正しく表示されるか確認

### 3. 地図確認（実装後）

```
地図表示
```

座標が正しく地図上に表示されるか確認

---

## 🔄 データの更新

### 既存データを更新する場合

1. **エクスポート**: 現在のデータをCSVでダウンロード
2. **編集**: Excelで必要な変更を加える
3. **削除**: 既存データを削除（または特定の候補地のみ削除）
4. **再アップロード**: 編集したCSVをアップロード

### 追加のみの場合

- 新しいデータのみを含むCSVを作成
- そのままアップロード（既存データに追加される）

---

## 📞 サポート

問題が解決しない場合:

1. **エラーメッセージをコピー**
2. **CSVファイルの最初の3行をコピー**
3. **ブラウザのコンソール（F12）でエラーを確認**
4. **問題を報告**

---

## 🎯 次のステップ

1. ✅ サンプルCSVでアップロードテスト
2. 📝 独自データの作成
3. 📤 本番データのアップロード
4. 🗺️ 地図表示で確認
5. 📊 スクリーニングで分析

お疲れ様でした！🎉
